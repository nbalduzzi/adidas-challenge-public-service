<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/20/Adidas_Logo.svg/1024px-Adidas_Logo.svg.png" width="320" alt="Nest Logo" /></a>
</p>

## Description

Adidas Challenge Public Service API

## Tech Stack

**NodeJS version:** v12.12.0

**Framework:** [NestJS](https://nestjs.com/)

**Documentation**: [Swagger](https://swagger.io/)

## Considerations

1. This API being public needs to create a token with the `secret` on `.env` file. This secret it's the same for all API's, this means that the `jwt` generated by a `secret` (stored by env files), in a real project must be signed on `RS256` algorithm with a `.pem` file (`public.pem` file in public api and `private.pem` file in all the secured API's left). I used a simple `HS256` algorithm for sign the jwt only for challenge purpose.

2. This API for each endpoint request will call a middleware that will autogenerate a signed token with the `secret` stored in `.env` file. Is not the best solution, but this was only for challenge purpose.

## Security

### Authorization Header

The security of this api is `Bearer Auth JWT Authorization`

To use de API directly, the `JWT` need to be generated with the below payload for success authorization:

```json
{
  {
    "origin": "adidas-challenge-public-service",
    "resource": "subscriptions",
    "timestamp": 1617895752000
  }
}
```

> The api is not validating the origin and resource by role, you can put any origin or resource, it is the same for the api. **All the fields are mandatory**.

The `timestamp` to use must be in milliseconds and can be *at least* 2 min before the current timestamp in milliseconds. This aproach was to avoid retries or force brute attacks.

The algorithm used was `HS256` and the secret for hashing the jwt is in `.env` file

### Helmet and Cors

1. `Cors` was enabled for challenge purpose. Is not fully configurated for special origins.

2. `Helmet` used for helping setting various HTTP headers for security reasons.

### Validation Input Data

Validation pipe added for validate controllers DTO's structure.

## Installation

```bash
# Set the node version on .nvmrc file
$ nvm use

# Install dependencies
$ npm install
```

## Running the app

```bash
# development
$ npm run start # run on port 3000

# watch mode
$ npm run start:dev # run on port 3000

# production mode
$ npm run start:prod # run on port 3000
```

> Healt Check enpoint on `http://localhost:3000/ping`

## Test

```bash
# unit tests
$ npm run test

# e2e tests
$ npm run test:e2e

# test coverage
$ npm run test:cov
```

## Docker

```bash
# Docker build image
$ docker build . -t adidas-challenge-public-service

# Docker run image
$ docker run -p3000:3000 adidas-challenge-public-service
```

### Docker Compose

```bash
# Up containers
$ docker-compose up

# Clean and up containers
$ docker-compose up --build --force-recreate
```

## Documentation

Swagger documentation only on dev instance: `http:localhost:3000/api`

## License

[MIT licensed](LICENSE).
